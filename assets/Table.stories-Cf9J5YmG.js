import{B as h,c as w,U as i,u as k}from"./Utils-C7ThPTTu.js";import{C as y}from"./Checkbox-CTVjkoEw.js";import{D as E}from"./Dropdown-BFbw9Seo.js";/* empty css                 */import T from"./TableAPIdoc-BplrVsv6.js";import"./index-ksVrQ76b.js";import"./iframe-DAf7hKWT.js";import"./preload-helper-DLLWEBaG.js";let _=class extends h{constructor(e={},t=[]){let s=document.createElement("div");const a=document.createElement("table");super(s,e.theme||"var(--color-primary-100)"),this.UItype="Table",this.id=e.id,this.options={...this.config,...e},this.data=t,this.table=a,this.dataCounts=this.data.length,this._init()}get config(){return{id:"",container:null,limits:50,name:"defaultTable",classes:["table-container"],cols:[],selection:"checkbox"}}_init(){this.tableBody=document.createElement("tbody"),this.tableHeader=new P(this.options.cols,this.options.selection);let e=this.options.cols.length;this.skeleton=new L({type:"table",colNum:this.options.selection?e+1:e}),w(this,this.options.cols),this._createPagination(),this._render(),this._bindEvent()}_render(){super.setTheme(this.options.theme),i.setProperty(this._elem,"--theme",this._theme),this.dataCounts<1?this.tableBody.appendChild(this.skeleton.getElem()):this.skeleton.hide(),this.table.id=this.id,this.table.appendChild(this.tableHeader.getElem()),this.table.appendChild(this.tableBody),this._elem.appendChild(this.table),i.addClass(this.table,["table"]),i.addClass(this._elem,this.options.classes),this._updateRows(),this._renderRows(0,this.options.limits),this.options.container?(this.options.container.appendChild(this._elem),this._elem.after(this._pagination.getElem())):console.error("請指定table要放入的位置")}_bindEvent(){}_setRows(e,t){let s=this;return e.map((n,r)=>new S(n,r,t,s))}_updateRows(){this.tableRows=this._setRows(this.data)}_renderRows(e,t){if(!this.tableRows)return;let s=this.tableRows.slice(e,t),a=document.createDocumentFragment();for(let r of s)a.appendChild(r.getElem());let n=this.tableBody.querySelectorAll("tr[data-index]");for(let r of n)r.remove();this.tableBody.appendChild(a),this._elem.scrollTop=0}setSize(e,t="auto"){i.setStyle(this._elem,"width",`${e}px`),i.setStyle(this._elem,"height",`${t}px`)}getTableData(){if(!this.tableRows){console.error("No Data Yet!");return}return this.tableRows.map(t=>t.data)}getSelected(){}setData(e){this.data=e,this.dataCounts=this.data.length,this._pagination.renderPage(this.dataCounts),this._render()}_createPagination(){this._pagination=new R({theme:this._theme,currentPage:1,pageSize:this.options.limits,total:this.dataCounts,handler:e=>{console.log("handler page:",e);const t=(e-1)*this.options.limits,s=t+this.options.limits;this._renderRows(t,s)}})}};class P extends h{constructor(e,t){const s=document.createElement("thead");super(s),this.UItype="TableHeader",this.cols=e,this.selection=this._checkSelection(t),this._init()}_init(){this._render()}_render(){const e=document.createElement("tr"),t=document.createDocumentFragment();if(this.selection.UItype==="Checkbox"){const s=document.createElement("th");s.appendChild(this.selection.getElem()),e.appendChild(s)}for(let s of this.cols){let a=document.createElement("th");i.setAttribute(a,"field",s.field),i.setText(a,s.title),t.appendChild(a)}e.appendChild(t),this._elem.appendChild(e)}_checkSelection(e){let t=document.createElement("th");if(e==="checkbox")return new y(t,{checked:!1});if(e==="radio")return}}class S extends h{constructor(e,t,s="checkbox",a){const n=document.createElement("tr");super(n),this.UItype="TableRow",this.data=e,this.selection=this._checkSelection(s),this.cells=this._setTableCells(this.data,k(a)),this.index=++t,this._init()}_init(){let e=document.createDocumentFragment();this.selection&&e.appendChild(this.selection.container);for(let t of this.cells)e.appendChild(t.getElem());this._elem.appendChild(e),i.setAttribute(this._elem,"index",this.index),this._bindEvent()}_bindEvent(){function e(){this.selection.getChecked()?i.setAttribute(this._elem,"rowSelected"):delete this._elem.dataset.rowselected}this.selection&&this.onevent(this.selection.getElem(),"change",e.bind(this))}_checkSelection(e){let t=document.createElement("td");if(e==="checkbox")return new y(t,{checked:!1});if(e==="radio")return}_setTableCells(e,t){return Object.values(e).map((a,n)=>new D(a,t[n]))}}class D extends h{constructor(e,t){const s=document.createElement("td");super(s),this.UItype="TableCell",this.dataValue=e,this.config=t,this._init()}_init(){this._render()}_render(){let{field:e,align:t="left"}=this.config;switch(t){case"center":i.addClass(this._elem,["text-center"]);break;case"right":i.addClass(this._elem,["text-right"]);break;default:i.clearClass(this._elem);break}i.setAttribute(this._elem,"field",e),i.setText(this._elem,this.dataValue)}}//! 未來要獨自拆出檔案
class R extends h{constructor(e){const t=document.createElement("div");i.addClass(t,["pagination"]),super(t,e.theme||"var(--color-primary-500)"),this.UItype="Pagination",this._config=e,this.currentPage=e.currentPage||1,this.total=Math.ceil(this._config.total/this._config.pageSize),this.pages=this._createPages(this.total,this.currentPage),this.handler=e.handler,this._init()}get config(){return{jump:!0,initCurrentPage:1,pageSize:20,total:null,...this._config}}set config(e){this._config={...this.config,...e}}_init(){this._render(),this._bindEvent()}_render(){console.log(this),this._elem.innerHTML="",super.setTheme(this._theme),i.setProperty(this._elem,"--theme",this._theme);let e=document.createDocumentFragment();for(let t=0;t<this.pages.length;t++){let s=document.createElement("button");switch(s.type="button",this.pages[t].current&&i.setAttribute(s,"currentPage"),i.addClass(s,["page-item"]),this.pages[t].type){case"prev-page":i.setText(s,"<<"),i.setAttribute(s,"prev");break;case"next-page":i.setText(s,">>"),i.setAttribute(s,"next");break;case"start-ellipsis":i.setText(s,"..."),s.disabled=!0;break;case"end-ellipsis":i.setText(s,"..."),s.disabled=!0;break;default:i.setText(s,this.pages[t].page),s.dataset.page=this.pages[t].page;break}(this.pages[t].page<1||this.pages[t].page>this.total)&&(this.pages[t].page=this.currentPage,s.disabled=!0),e.appendChild(s)}this._elem.appendChild(e),this.config.jump&&this._createJumpCompo()}_bindEvent(){function e(t){if(t.stopPropagation(),!t.target.classList.contains("page-item"))return;let s=Number(t.target.dataset.page);s||(s=t.target.hasAttribute("data-prev")?this.currentPage-1:t.target.hasAttribute("data-next")?this.currentPage+1:this.currentPage),this.goPage(s),this.handler(s)}super.onevent(this._elem,"click",e.bind(this))}_createPages(e,t){let s=[],a=this._config.pageSize,n={type:"prev-page",page:this.currentPage-1,current:!1},r={type:"next-page",page:this.currentPage+1,current:!1};for(let l=1;l<=e;l++){let o;l===1||l===t||l===e||l===t+1||l===t-1?o="page":l<=t+a?o="start-ellipsis":l>=t+a&&(o="end-ellipsis");let d={type:o||"page",page:l,current:l===t};s.push(d)}console.log(s);let u=s.filter((l,o)=>{const{type:d}=l;return!(d==="start-ellipsis"&&s[o+1].type==="start-ellipsis"||d==="end-ellipsis"&&s[o+1].type==="end-ellipsis"||d==="start-ellipsis"&&s[o+1].type==="end-ellipsis")});return[n,...u,r]}_createJumpCompo(){if(this.total<=0)return;let e=document.createElement("div");i.addClass(e,["pagination-jump"]);let t=[];for(let n=1;n<=this.total;n++){let r={value:n,text:n};n===this.currentPage&&(r.selected=!0),t.push(r)}let s=new E("jump-dropdown",t,{filter:!0,filterHandler:function(){let r=this.value;this.parentNode.parentNode.querySelectorAll(".dropdown-item li").forEach(l=>{l.textContent.includes(r)?l.classList.remove("hidden"):l.classList.add("hidden")})}},(function(n){let r=Number(n.target.value);this.goPage(r),this.handler(r)}).bind(this));console.log(s);let a=document.createDocumentFragment();a.appendChild(document.createTextNode("前往第")),a.appendChild(s.containerEl),a.appendChild(document.createTextNode("頁")),e.appendChild(a),this._elem.appendChild(e)}renderPage(e){this._config={...this._config,total:e},this.total=Math.ceil(e/this._config.pageSize),this.pages=this._createPages(this.total,this.currentPage),this._render()}setCurrentPage(e){this.currentPage=e,this.pages=this._createPages(this.total,this.currentPage)}goPage(e){console.log(`go ${e} page`),!(e<1||e>this.total)&&(this.setCurrentPage(e),this._render())}}//! 未來要獨自拆出檔案
class L extends h{constructor(e){let t;switch(e.type){case"table":t=document.createElement("tr");break;case"text":break;case"img":break;default:t=document.createElement("div")}super(t),this.UItype="Skeleton",this.options=e,this._render()}_render(){i.addClass(this._elem,["skeleton"]),this.defineType(this.options.type,this.options?.colNum)}defineType(e,t){switch(i.clearClass(this._elem,["skeleton"]),e){case"table":i.addClass(this._elem,["table-skeleton"]),this._elem.innerHTML=`
          <td colspan='${t}' class="shadow-sm animate-pulse">
              <div class="flex items-center justify-between">
                  <div>
                      <div class="h-2.5 bg-gray-300 rounded-full w-24 mb-2.5"></div>
                      <div class="w-32 h-2 bg-gray-200 rounded-full"></div>
                  </div>
                  <div class="h-2.5 bg-gray-300 rounded-full w-12"></div>
              </div>
              <div class="flex items-center justify-between pt-4">
                  <div>
                      <div class="h-2.5 bg-gray-300 rounded-full w-24 mb-2.5"></div>
                      <div class="w-32 h-2 bg-gray-200 rounded-full"></div>
                  </div>
                  <div class="h-2.5 bg-gray-300 rounded-full w-12"></div>
              </div>
              <div class="flex items-center justify-between pt-4">
                  <div>
                      <div class="h-2.5 bg-gray-300 rounded-full w-24 mb-2.5"></div>
                      <div class="w-32 h-2 bg-gray-200 rounded-full"></div>
                  </div>
                  <div class="h-2.5 bg-gray-300 rounded-full w-12"></div>
              </div>
              <span class="sr-only">Loading...</span>
          </td>`;break;case"text":i.addClass(this._elem,["text-skeleton"]),this._elem.innerHTML=`
          <div role="status" class="max-w-sm animate-pulse">
              <div class="h-2.5 bg-gray-200 rounded-full w-48 mb-4"></div>
              <div class="h-2 bg-gray-200 rounded-full max-w-[360px] mb-2.5"></div>
              <div class="h-2 bg-gray-200 rounded-full mb-2.5"></div>
              <div class="h-2 bg-gray-200 rounded-full max-w-[330px] mb-2.5"></div>
              <div class="h-2 bg-gray-200 rounded-full max-w-[300px] mb-2.5"></div>
              <div class="h-2 bg-gray-200 rounded-full max-w-[360px]"></div>
              <span class="sr-only">Loading...</span>
          </div>`;break;case"img":i.addClass(this._elem,["img-skeleton"]),this._elem.innerHTML=`
          <div role="status" class="flex items-center justify-center h-56 max-w-sm bg-gray-300 rounded-lg animate-pulse">
              <svg class="w-10 h-10 text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 20">
              <path d="M5 5V.13a2.96 2.96 0 0 0-1.293.749L.879 3.707A2.98 2.98 0 0 0 .13 5H5Z"/>
              <path d="M14.066 0H7v5a2 2 0 0 1-2 2H0v11a1.97 1.97 0 0 0 1.934 2h12.132A1.97 1.97 0 0 0 16 18V2a1.97 1.97 0 0 0-1.934-2ZM9 13a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2Zm4 .382a1 1 0 0 1-1.447.894L10 13v-2l1.553-1.276a1 1 0 0 1 1.447.894v2.764Z"/>
            </svg>
              <span class="sr-only">Loading...</span>
          </div>`;break}}show(){i.removeClass(this._elem,["hidden"])}hide(){i.addClass(this._elem,["hidden"])}}window.Table=_;const B=({id:c,name:e,limits:t,selection:s,container:a,cols:n,tools:r,theme:u,classes:l,complete:o,error:d,handler:v})=>{let m=document.createElement("div");m.className="mx-auto grid place-items-center";let p=document.createElement("button");p.className="btn btn-primary mb-3",p.textContent="create Table",m.appendChild(p);let x={id:c,name:e,limits:t,container:m,cols:n,tools:r,selection:s,theme:u,classes:l,complete:o,error:d,handler:v};async function C(g){return await fetch(g)}return p.addEventListener("click",()=>{let g=new _(x);C("https://jsonplaceholder.typicode.com/todos").then(f=>f.json()).then(f=>{setTimeout(()=>{g.setData(f),console.log("table_instance:",g)},5e3)})}),m},{fn:U,expect:z}=__STORYBOOK_MODULE_TEST__,{action:$}=__STORYBOOK_MODULE_ACTIONS__,Z={title:"Components/Table",tags:["autodocs"],parameters:{docs:{source:{format:!0,language:"html"},page:T}},render:({...c})=>B({...c}),argTypes:{id:{control:"text",type:{required:!0},description:"表格元素id",table:{category:"configurations",type:{summary:"string"}}},name:{control:"text",description:"Table name",table:{category:"configurations",defaultValue:{summary:"-"},type:{summary:"string"}}},limits:{control:"number",description:"每頁顯示的最多筆數",min:1,table:{category:"configurations",defaultValue:{summary:"50"},type:{summary:"number"}}},container:{control:"text",description:"要放入的DOM元素",table:{category:"configurations",defaultValue:{summary:"null"},type:{summary:"string"}}},cols:{control:"array",description:"欄位設定及帶入值",table:{category:"configurations",defaultValue:{summary:"-"},type:{summary:"array"}}},selection:{control:"select",options:["checkbox","radio"],description:"是否要有勾選功能",table:{category:"configurations",defaultValue:{summary:"checkbox"},type:{summary:"string"}}},tools:{control:"boolean",description:"是否要有基本工具列",table:{category:"configurations",defaultValue:{summary:"true"},type:{summary:"boolean"}}},theme:{control:"color",description:"表格色系",table:{category:"configurations",defaultValue:{summary:"var(--color-primary-500)"},type:{summary:"string"}}},complete:{control:"function",description:"完成資料載入後要執行的函式",table:{category:"configurations",type:{summary:"function"}}},classes:{control:{type:"array"},description:"自定義class，每個class以tailwindcss property放入",table:{category:"configurations",defaultValue:{summary:".table-container"},type:{summary:"array"}}},error:{control:{type:"function"},description:"資料載入失敗時要執行的函式",table:{category:"configurations",type:{summary:"function"}}},handler:{action:"click",control:"function",description:"點擊觸發元素後的callback函式",table:{category:"configurations",defaultValue:{summary:"null"},type:{summary:"function"}}}},args:{id:"table_first",classes:["table-container"],limits:20,selection:"checkbox",tools:!0,theme:"var(--color-primary-100)"}},b={args:{id:"test-table",name:"測試表格",cols:[{field:"useId",title:"使用者id",sort:!0,fixed:!1,align:"center"},{field:"id",title:"編號",sort:!1,fixed:!1,align:"center"},{field:"title",title:"內容",sort:!0,fixed:!1},{field:"done",title:"完成",sort:!0,fixed:!1}],limits:20}};b.parameters={...b.parameters,docs:{...b.parameters?.docs,source:{originalSource:`{
  args: {
    id: "test-table",
    name: "測試表格",
    cols: [{
      field: 'useId',
      title: '使用者id',
      sort: true,
      fixed: false,
      align: "center"
    }, {
      field: 'id',
      title: '編號',
      sort: false,
      fixed: false,
      align: "center"
    }, {
      field: 'title',
      title: '內容',
      sort: true,
      fixed: false
    }, {
      field: 'done',
      title: '完成',
      sort: true,
      fixed: false
    }],
    limits: 20
  }
  // play: async ({ args, canvas, userEvent }) => {
  //   await userEvent.type(canvas.getByText('一般勾選框'), '勾選框');
  //   await userEvent.click(canvas.getByLabelText('一般勾選框'));
  //   await expect(args.handlers).toHaveBeenCalled();
  // }
}`,...b.parameters?.docs?.source}}};const q=["Table"];export{b as Table,q as __namedExportsOrder,Z as default};
