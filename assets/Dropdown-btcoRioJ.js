import{D as p}from"./index-vRTWSlA6.js";class f extends p{constructor(t,e,n=null,i=null){let l,s;if(t instanceof HTMLElement?l=t:(l=document.createElement("ul"),l.id=`${t}_dropdown`,l.classList.add("dropdown-item")),e instanceof HTMLElement)s=e;else{let d=document.createElement("label");d.classList.add("input-label"),s=document.createElement("input"),s.classList.add("dropdown-input"),d.appendChild(s),l.insertAdjacentElement("afterBegin",d)}super(l,s),this.dropdownChildren=this._targetEl.children,this._options={...this._options,...this.config},this.bindSelect=this._targetEl.nextElementSibling||this._createBindSelect(t,e),this.containerEl=t.parentElement||this._createContainer(),i&&(this.changeHandler=i.bind(this.bindSelect)),this.optValuePair=this.getMatchValue(this.bindSelect.options[this.bindSelect.selectedIndex].text),this._triggerEl.readOnly=!0,this._triggerEl.tagName==="INPUT"&&n&&(this.bindFilteroption=n),this._init()}_createBindSelect(t,e){let n=document.createElement("select");return n.classList.add("select","dropdown-select"),n.id=t,e.forEach(i=>{let l=document.createElement("option");l.value=i.value,l.textContent=i.text,i.selected&&(l.selected=!0),n.appendChild(l)}),n}_createContainer(){let t=document.createElement("div");return t.classList.add("w-full"),t.appendChild(this._triggerEl.parentElement),t.appendChild(this._targetEl),t.appendChild(this.bindSelect),t}_init(){super.init(),super.hide(),this.dropdownChildren.length===0&&(Array.from(this.bindSelect.options).forEach(t=>{let e=document.createElement("li");e.textContent=t.textContent,this._targetEl.appendChild(e)}),this.getDropdownChildren()),this._triggerEl.value=this.optValuePair.text,this.bindSelect.value=this.optValuePair.value,this._bindBasicHandler(),this._targetEl.dataset.drop=!0,this.optValuePair.value==="不拘"||this.optValuePair.value==="全部"?this.ifAll=!0:this.optValuePair.value==="目前圖面範圍"&&(this.ifMap=!0,this.ifAll=!0)}get config(){return{placement:"bottom",triggerType:"click",offsetSkidding:0,offsetDistance:10,ignoreClickOutsideClass:!1}}_bindBasicHandler(){this.changeHandler&&this.bindSelect.addEventListener("change",this.changeHandler),this._targetEl.addEventListener("mousedown",t=>{t.stopPropagation();let e=t.target.textContent;this._triggerEl.value=e,this.optValuePair=this.getMatchValue(e),this.bindSelect.value=this.optValuePair.value,this.bindSelect.dispatchEvent(new Event("change")),super.hide()}),this.bindFilteroption?.filter&&this._bindfilterHandler()}_bindfilterHandler(){this._triggerEl.addEventListener("focus",()=>{this._triggerEl.removeAttribute("readOnly"),this._triggerEl.addEventListener("input",this.bindFilteroption.filterHandler.bind(this._triggerEl))}),this._triggerEl.addEventListener("blur",()=>{this._triggerEl.setAttribute("readOnly",!0),this._triggerEl.removeEventListener("input",this.bindFilteroption.filterHandler.bind(this._triggerEl))})}getdropDownInstance(){return this}getDropdownChildren(){return this.dropdownChildren=this._targetEl.children,this.dropdownChildren}getTargetDropdown(){return this._targetEl}getBindSelect(){return this.bindSelect}clearDropdown(){if(this.dropdownChildren){if(this.bindSelect)for(;this.bindSelect.firstChild;)this.bindSelect.firstChild.remove();for(;this._targetEl.firstChild;)this._targetEl.firstChild.remove()}}renderDropdownChildren(t,e,n,i=null){if(this.ifMap&&!Array.from(this.bindSelect.options).some(r=>["目前圖面範圍"].includes(r.textContent))){let r=document.createElement("li"),a=document.createElement("option");r.textContent="目前圖面範圍",a.textContent="目前圖面範圍",a.value="map",this._targetEl.appendChild(r),this.bindSelect.appendChild(a)}let l=["不拘","全部","全縣"];if(this.ifAll&&!Array.from(this.bindSelect.options).some(r=>l.includes(r.textContent))){let r=Array.from(this.bindSelect.options).filter(u=>l.includes(u.textContent)).textContent||"不拘",a=document.createElement("li"),h=document.createElement("option");a.textContent=r,h.textContent=r,h.value="all",this._targetEl.appendChild(a),this.bindSelect.appendChild(h)}let s=n;(i===" "||!i&&n==="")&&(s="-"),t.textContent=s,!Array.from(this.bindSelect.options).some(r=>r.textContent===s)&&(this._targetEl.appendChild(t),e&&(i!==null?e.value=i:e.value=n,e.textContent=s,this.bindSelect.appendChild(e)),this.bindFilteroption?.filter&&(this._triggerEl.readOnly=!1))}getMatchValue(t){let n=Array.from(this.bindSelect.children).map(i=>({value:i.value,text:c(i.textContent)})).filter(i=>i.text===t)[0];if(!n){console.error("getMatchValue() 取值錯誤");return}return n}updateValue(){let t=this.bindSelect.selectedIndex,e=c(this.bindSelect.options[t].textContent);this.optValuePair=this.getMatchValue(e),console.log("after update:",this.optValuePair),this._triggerEl.value=this.optValuePair.text}}function c(o){return o===[" "][0]?"-":o}export{f as D};
