import{B as w,D as m}from"./Utils-DOz9aA_P.js";import E from"./PaletteAPIdoc-BRi1Gg4-.js";import"./iframe-BVS5Mtot.js";import"./preload-helper-DLLWEBaG.js";const x=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],S=[0,60,120,180,240,300],T=["red","yellow","green","cyan","blue","purple"],$=T.reduce((p,t,a)=>(p[t]=S[a],p),{}),C=new Map;for(let p=0;p<x.length;p++)C.set(p,x[p]);class g{static normalizeCircular(t){return(t%360+360)%360}static getRandomNum(t,a){let n=[t,a].sort((e,o)=>e-o);return Math.floor(Math.random()*(n[1]-n[0]+1))+n[0]}static randomDigit(){return Math.floor(Math.random()*15)+1}static randomHexColor(){let t="#";for(let a=0;a<6;a++)t+=C.get(g.randomDigit());return t}static tohexDigits(t){let a=t.map(n=>Array.from(C.values()).indexOf(n.toLowerCase()));return a[0]*16+a[1]}static circular_distance(t,a){const n=Math.abs(t-a);return Math.min(n,360-n)}static luminance(t){let[a,n,e]=t.replace(/[rgb()\s+]/g,"").split(",");return(.2126*a+.7152*n+.0722*e)/255}}var M={colorCounts:1,alpha:1,colorMode:"hex",style:"random",tone:T[g.getRandomNum(0,5)],offset:10,saturationFixed:!1,lightnessFixed:!1};function R(p=M){let t=Object.assign({},M,p),a=t.colorMode,n=P(t);switch(a){case"hex":return n.map(e=>e.toHex());case"rgb":return n.map(e=>e.toRgb());default:return n.map(e=>e.toHsl())}}function P({colorCounts:p,alpha:t,style:a,tone:n,offset:e,saturationFixed:o,lightnessFixed:i}){let c=[],s=$[n];for(let u=0;u<p;u++){let l=B(a,s),r=O(o),d=D(i),h=new v(l,r,d,t);c.push(h)}return c.sort(function(u,l){let r=116*Math.pow((u.luminance+.055)/1.055,2)-16;return 116*Math.pow((l.luminance+.055)/1.055,2)-16-r})}function B(p,t,a){function n(e){let o;switch(e){case"contrast":o=t+g.getRandomNum(120,240);break;case"same":o=t+g.getRandomNum(-30,30);break;default:o=g.getRandomNum(0,359);break}return g.normalizeCircular(o)}return n(p)}function O(p=!1){return typeof p=="number"?p:g.getRandomNum(20,90)}function D(p=!1){return typeof p=="number"?p:g.getRandomNum(20,90)}class v{constructor(t,a,n,e){this.base={h:t,s:a,l:n,a:e},this.luminance=g.luminance(this.toRgb())}toRgb(){return y.hslTorgb(this.toHsl())}toHex(){return y.hslTohex(this.toHsl())}toHsl(){let{h:t,s:a,l:n,a:e}=this.base;return e!==1?`hsl(${t} ${a} ${n} / ${e})`:`hsl(${t} ${a} ${n})`}}class y{static hexTorgb(t){let a="";const n=Array.from(t.slice(1,3)),e=Array.from(t.slice(3,5)),o=Array.from(t.slice(5,7)),i=Array.from(t.slice(7,9));let c=g.tohexDigits(n),s=g.tohexDigits(e),u=g.tohexDigits(o),l=Math.round(g.tohexDigits(i)/255*100)/100;return l==1?a=`rgb(${c},${s},${u})`:a=`rgb(${c},${s},${u},${l})`,a}static rgbTohsl(t){let n=t.toLowerCase().replace(/[rgb()\s+]/g,"").split(",").map(b=>Math.round(b/255*100)/100),[e,o,i,c]=n,s=Math.max(...n),u=Math.min(...n),l=s-u,r,d,h,f;return s===u?r=0:s==e&&o>=i?r=60*((o-i)/l)+0:s==e&&o<i?r=60*((o-i)/l)+360:s==o?r=60*((i-e)/l)+120:s==i&&(r=60*((e-o)/l)+240),h=Math.round((s+u)/2*100)/100,h==0||s==u?d=0:h>0&&h<=.5?d=Math.round(Math.abs(l/(2*h))*100):h>.5&&(d=Math.round(Math.abs(l/(2-2*h))*100)),d=d>100?100:d,h=h*100>100?100:h*100,f=c||1,f!==1?`hsl(${Math.round(r)},${d}%,${h}%/${f})`:`hsl(${Math.round(r)},${d}%,${h}%)`}static hslTorgb(t){let a=t.toLowerCase().replace(/[hsl()/+]/g,"").replace(/\s+/g,",").split(","),[n,e,o,i]=a;n=(n%360+360)%360,e=parseInt(e)/100,o=parseInt(o)/100;const c=(1-Math.abs(2*o-1))*e,s=n/60,u=c*(1-Math.abs(s%2-1));let l=0,r=0,d=0;0<=s&&s<1?[l,r,d]=[c,u,0]:1<=s&&s<2?[l,r,d]=[u,c,0]:2<=s&&s<3?[l,r,d]=[0,c,u]:3<=s&&s<4?[l,r,d]=[0,u,c]:4<=s&&s<5?[l,r,d]=[u,0,c]:5<=s&&s<6&&([l,r,d]=[c,0,u]);const h=o-c/2,f=Math.round((l+h)*255),b=Math.round((r+h)*255),k=Math.round((d+h)*255);return i&&i!==1?`rgb(${f},${b},${k},${i})`:`rgb(${f},${b},${k})`}static rgbTohex(t){return`#${t.replace(/[rgb()\s+]/g,"").split(",").map(e=>{e=parseFloat(e),e<1&&(e=Math.floor(e*255));let o=e%16;return`${C.get(Math.floor(e/16))}${C.get(o)}`}).join("")}`}static hslTohex(t){let a=y.hslTorgb(t);return y.rgbTohex(a)}}const q="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8%203.5V12.5M12.5%208H3.5'%20stroke='white'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e";var L={limits:5,defaults:[]};class F extends w{constructor(t={}){const a=document.createElement("div");m.addClass(a,["color-picker"]),super(a),this.UItype="ColorPicker",this._config=Object.assign({},L,t),this.defaultColors=[...this._config.defaults].slice(0,this._config.limits),this.colors=[...this.defaultColors],this.current=this.colors[0],this._picker=this._createPickerpanel(),this._init(),this._render(),this._bindEvent()}get picker(){return this._picker}get _picked(){return y.rgbTohsl(this.current)}_init(){for(let n of this.defaultColors){const e=document.createElement("div");m.addClass(e,["color"]),e.style.backgroundColor=n,m.setAttribute(e,"colorpick",n),this.onevent(e,"click",o=>{const i=o.target.dataset.colorpick;this.current=i,m.addClass(this._picker,["visible"]),m.setAttribute(this._picker,"currentpick",i),this._paintCanvas(this._picker.querySelector("canvas"),y.rgbTohsl(i)),this._updatePanel()}),this.getElem().appendChild(e)}m.addClass(this._picker,["picker"]);const t=document.createElement("button");t.type="button";const a=document.createElement("img");a.src=q,t.append(a),m.addClass(t,["btn","btn-sm","btn-primary","add-color-btn"]),this.getElem().appendChild(t),this._addBtn=t,this.getElem().appendChild(this._picker)}_bindEvent(){const t=this._picker.querySelector(".color-track"),a=this._picker.querySelector(".hue-track"),n=this._picker.querySelector(".alpha-track");this._picker.querySelector(".hue-track .picker-btn"),this._picker.querySelector(".alpha-track .picker-btn"),this._picker.querySelector(".color-track .picker-btn");let e=1,o=1,i=0,c=1;this._addBtn&&this.onevent(this._addBtn,"click",s.bind(this)),this.onevent(t,"pointerdown",r=>{console.log("e.target:",r.target),t.setPointerCapture(r.pointerId),r.preventDefault()}),this.onevent(a,"pointerdown",r=>{console.log("e.target:",r.target),a.setPointerCapture(r.pointerId),r.preventDefault()}),this.onevent(n,"pointerdown",r=>{console.log("e.target:",r.target),n.setPointerCapture(r.pointerId),r.preventDefault()}),this.onevent(t,"pointermove",r=>{const{left:d,top:h,width:f,height:b}=r.currentTarget.getBoundingClientRect();e=u((r.clientX-d)/f),o=u(1-(r.clientY-h)/b)}),this.onevent(a,"pointermove",r=>{const{left:d,width:h}=r.currentTarget.getBoundingClientRect();i=u((r.clientX-d)/h)*360}),this.onevent(n,"pointermove",r=>{const{left:d,width:h}=r.currentTarget.getBoundingClientRect();c=u((r.clientX-d)/h)}),this.onevent(t,"pointerup",r=>{l.call(this)}),this.onevent(a,"pointerup",r=>{l.call(this)}),this.onevent(n,"pointerup",r=>{l.call(this)});function s(){m.toggleClass(this._picker,["visible"])}function u(r,d=0,h=1){return Math.min(h,Math.max(d,r))}function l(){const r=new v(Math.round(i),Math.round(e*100),Math.round(o*100),c);console.log("updateCurrentColor:",r),this.current=r.toRgb(),this._updatePanel()}}_render(){this._updatePanel(),this.colors.length>this._config.limits&&m.addClass(this._addBtn,["hidden"])}_createPickerpanel(){const t=document.createElement("div"),a=document.createElement("div"),n=document.createElement("canvas"),e=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div");m.addClass(i,["current-picked-color"]),m.setAttribute(t,"currentpick",this._picked),this._paintCanvas(n,this._picked);const c=document.createElement("button"),s=document.createElement("button"),u=document.createElement("button"),l=document.createElement("div"),r=document.createElement("div");return a.append(n,c),l.append(u),r.append(s),o.append(r,l),e.append(i,o),t.append(a,e),m.addClass(a,["color-track"]),m.addClass(l,["alpha-track"]),m.addClass(r,["hue-track"]),m.addClass(c,["picker-btn"]),m.addClass(s,["picker-btn"]),m.addClass(u,["picker-btn"]),t}_paintCanvas(t,a){const n=t.width,e=t.height,o=t.getContext("2d");o.fillStyle=`hsl(${a.toLowerCase().replace(/[hsl()/+]/g,"").replace(/\s+/g,",").split(",")[0]},100%,50%)`,o.fillRect(0,0,n,e);const i=o.createLinearGradient(0,0,n,0);i.addColorStop(0,"rgba(255,255,255,1)"),i.addColorStop(1,"rgba(255,255,255,0)"),o.fillStyle=i,o.fillRect(0,0,n,e);const c=o.createLinearGradient(0,e,0,0);c.addColorStop(0,"rgba(0,0,0,1)"),c.addColorStop(1,"rgba(0,0,0,0)"),o.fillStyle=c,o.fillRect(0,0,n,e)}_updatePanel(){console.log("updatepanel's this.current:",this.current);const[t,a,n,e=1]=y.rgbTohsl(this.current).toLowerCase().replace(/[hsl()/+]/g,"").replace(/\s+/g,",").split(","),o=new v(t,a,n,e),i=this._picker.querySelector(".color-track"),c=this._picker.querySelector(".hue-track"),s=this._picker.querySelector(".alpha-track"),u=this._picker.querySelector(".hue-track .picker-btn"),l=this._picker.querySelector(".alpha-track .picker-btn"),r=this._picker.querySelector(".color-track .picker-btn");this._paintCanvas(i.querySelector("canvas"),o.toHsl()),m.setProperty(u,"--hue",t),m.setProperty(s,"--hue",t),r.style.left=a*i.querySelector("canvas").offsetWidth+"px",r.style.top=(1-n)*i.querySelector("canvas").offsetHeight+"px",u.style.left=t/360*c.offsetWidth+"px",l.style.left=e*s.offsetWidth+"px",console.log(e,e*s.offsetWidth),m.setProperty(this._picker,"--picker-bg",this.current)}}const H=({colorCounts:p,colorMode:t,alpha:a,style:n,tone:e,offset:o,saturationFixed:i,lightnessFixed:c,saturation:s,lightness:u})=>{let l=document.createElement("div");l.className="flex";const d=R({colorCounts:p,colorMode:t,alpha:a,style:n,tone:e||"red",offset:o,saturationFixed:i&&s,lightnessFixed:c&&u});for(let b=0;b<p;b++){const k=document.createElement("div");k.style.width="30px",k.style.height="30px",k.style.backgroundColor=d[b],l.appendChild(k)}var h={limits:5,defaults:[...d.slice(0,3)]};const f=new F(h);return console.log(f),l.appendChild(f.getElem()),l},{fn:V,expect:U}=__STORYBOOK_MODULE_TEST__,{action:W}=__STORYBOOK_MODULE_ACTIONS__,X={title:"Components/Palette",tags:["autodocs"],parameters:{docs:{source:{format:!0,language:"html"},page:E}},render:({...p})=>H({...p}),argTypes:{colorCounts:{control:{type:"number",min:1},type:{required:!0},description:"表格元素id",table:{category:"configurations",type:{summary:"number"}}},colorMode:{control:"select",description:"色碼模式",options:["hex","rgb","hsl"],table:{category:"configurations",defaultValue:{summary:"-"},type:{summary:"string"}}},style:{control:"select",options:["random","same","contrast"],description:"色系樣式",table:{category:"configurations",defaultValue:{summary:"random"},type:{summary:"string"}}},tone:{control:"select",options:["red","yellow","green","cyan","blue","purple"],description:"指定色系",table:{category:"configurations",defaultValue:{summary:"null"},type:{summary:"string"}}},offset:{control:{type:"number",min:1},description:"偏移量",table:{category:"configurations",defaultValue:{summary:"-"},type:{summary:"number"}}},alpha:{control:{type:"number",min:0,max:1},description:"透明度",table:{category:"configurations",defaultValue:{summary:"1"},type:{summary:"number"}}},saturationFixed:{control:"boolean",description:"是否固定飽和度",table:{category:"configurations",defaultValue:{summary:"false"},type:{summary:"number | boolean"}}},saturation:{if:{arg:"saturationFixed",truthy:!0},control:{type:"number",min:0,max:100},description:"飽和度固定值",table:{category:"configurations",defaultValue:{summary:"random(20~90)"},type:{summary:"number"}}},lightnessFixed:{control:"boolean",description:"是否固定明度",table:{category:"configurations",defaultValue:{summary:"false"},type:{summary:"number | boolean"}}},lightness:{if:{arg:"lightnessFixed",truthy:!0},control:{type:"number",min:0,max:100},description:"明度固定值",table:{category:"configurations",defaultValue:{summary:"random(20~90)"},type:{summary:"number"}}}},args:{colorCounts:1,colorMode:"hsl",alpha:1,style:"random",offset:10,tone:"red",saturationFixed:!1,lightnessFixed:!1}},_={args:{colorCounts:10,colorMode:"hsl",style:"random",alpha:1,offset:20,saturationFixed:!1,lightnessFixed:!0,saturation:90,lightness:70}};_.parameters={..._.parameters,docs:{..._.parameters?.docs,source:{originalSource:`{
  args: {
    colorCounts: 10,
    colorMode: 'hsl',
    style: 'random',
    alpha: 1,
    offset: 20,
    saturationFixed: false,
    lightnessFixed: true,
    saturation: 90,
    lightness: 70
  }
  // play: async ({ args, canvas, userEvent }) => {
  //   await userEvent.type(canvas.getByText('一般勾選框'), '勾選框');
  //   await userEvent.click(canvas.getByLabelText('一般勾選框'));
  //   await expect(args.handlers).toHaveBeenCalled();
  // }
}`,..._.parameters?.docs?.source}}};const j=["Palette"];export{_ as Palette,j as __namedExportsOrder,X as default};
