import{B as u,c as E,b as T,U as a,f as S,u as R}from"./Utils-6FG_Pzxt.js";import{C as y}from"./Checkbox-Bl0vwfoT.js";import{D as P}from"./Dropdown-BFbw9Seo.js";/* empty css                 */import A from"./TableAPIdoc-D9pm74h5.js";import"./index-ksVrQ76b.js";import"./iframe-BWigM8VB.js";import"./preload-helper-DLLWEBaG.js";const D="index",H="rowSelected",w="field";var L={id:"",container:null,limits:50,name:"defaultTable",classes:["table-container"],cols:[],selection:"checkbox"};let v=class extends u{constructor(e={},t=[]){let s=document.createElement("div");const i=document.createElement("table");s.appendChild(i),super(s,e.theme||"var(--color-primary-500)"),this.UItype="Table",this.id=e.id,this._config=Object.assign(L,e),this.data=t,this.table=i,this.dataCounts=this.data.length,this.tableBody=document.createElement("tbody"),this.tableHeader=new B(this);//!這邊傳入的this還沒建置完成!
let l=this.config.cols.length;this.skeleton=new z({type:"table",colNum:this.config.selection?l+1:l}),E(this,this.config.cols),this._createPagination();const[r,c,n]=T(new Map);this.getSelected=r,this.setSelected=c,this.subscribeSelected=n,this._init()}get config(){return this._config}_init(){this._render(),this._bindEvent()}_render(){console.log("table_render:",this),super.setTheme(this.config.theme),a.setProperty(this._elem,"--theme",this._theme),this.dataCounts<1?this.tableBody.appendChild(this.skeleton.getElem()):this.skeleton.hide(),this.table.id=this.id,this.table.appendChild(this.tableHeader.getElem()),this.table.appendChild(this.tableBody),a.addClass(this.table,["table"]),a.addClass(this._elem,this.config.classes),this.config.container&&(S(this.config.container).appendChild(this.getElem()),this._elem.after(this._pagination.getElem()))}_bindEvent(){this.onevent(this.tableBody,"click",(function(){const e=new Event("change");this._checkRowState()&&(this.tableHeader.selection.setChecked(!0),this.tableHeader.selection.getElem().dispatchEvent(e))}).bind(this),!1)}_setRows(e,t){let s=this;return e.map((l,r)=>{let c={data:l,index:++r,selection:t,table:s,subscribe:this.subscribeSelected};return new F(c)})}_updateRows(){this.tableRows=this._setRows(this.data),this.tableRows.forEach(e=>{this.onevent(e.getElem(),"click",(function(){if(this.getSelected().get(this._pagination.currentPage)){let t=this._checkRowState();console.log(e.selection.getChecked()),this.tableHeader.selection.setChecked(t),this.setSelected(this.getSelected().set(this._pagination.currentPage,t))}}).bind(this),!1)})}_checkRowState(){//! 如果有任何一row取消選取，也要改變header狀態
let e=this._pagination.currentPage*this.config.limits;return this.tableRows.filter(s=>s.index<=e&&s.index>e-this.config.limits).every(s=>s.selection.getChecked())}_showRows(e,t){if(!this.tableRows||this.tableRows.length===0)return;let s=this.tableRows.slice(e,t),i=document.createDocumentFragment();for(let r of s)i.appendChild(r.getElem());let l=this.tableBody.querySelectorAll("tr[data-index]");for(let r of l)r.remove();this.tableBody.appendChild(i),this._elem.scrollTop=0}setSize(e,t="auto"){a.setStyle(this._elem,"width",`${e}px`),a.setStyle(this._elem,"height",`${t}px`)}getTableData(){return this.tableRows?this.data:(console.error("No Data Yet!"),this.tableRows)}getSelectedRows(){return this.tableRows.filter(t=>t.selection.getChecked())}getFiltedRows(e){return this.tableRows.filter(e)}setData(e){this.data=e,this.dataCounts=this.data.length,this._pagination.renderPage(this.dataCounts);let t=this.getSelected();for(let s=0;s<this._pagination.total;s++)t.set(s+1,!1);return this.setSelected(t),this._updateRows(),this._render(),this._showRows(0,this.config.limits),this}selectedFullPage(e=this._pagination.currentPage){return this.setSelected(this.getSelected().set(e,!0)),this}_createPagination(){this._pagination=new M({theme:this._theme,currentPage:1,pageSize:this.config.limits,total:this.dataCounts,handler:e=>{const t=(e-1)*this.config.limits,s=t+this.config.limits;this._showRows(t,s);let i=this.getSelected().set(e,this.getSelected().get(e));console.log("table_createPagination handler:",this.getSelected()),this.setSelected(i),this.tableHeader.selection.setChecked(this.getSelected().get(e))}})}};class B extends u{constructor(e){const{cols:t,selection:s,theme:i}=e.config,l=document.createElement("thead");super(l,i),this.UItype="TableHeader",this.table=e,this.cols=t,this.selection=this._checkSelection(s),this._init()}_init(){this._render()}_render(){const e=document.createElement("tr"),t=document.createDocumentFragment();if(this.selection.UItype==="Checkbox"){const s=document.createElement("th");s.appendChild(this.selection.getElem()),e.appendChild(s)}for(let s of this.cols){let i=document.createElement("th");a.setAttribute(i,w,s.field),a.setText(i,s.title),t.appendChild(i)}e.appendChild(t),this._elem.appendChild(e)}_checkSelection(e){let t=document.createElement("th");if(e==="checkbox")return new y(t,{theme:this._theme,checked:!1,handlers:i=>{let l=this.table._pagination.currentPage;const r=l*this.table.config.limits*this.table.config.limits,c=l*this.table.config.limits-this.table.config.limits;this.table.tableRows.filter(o=>o.index>r&&o.index<=c).forEach(o=>{o.selection.setChecked(i)}),this.table.setSelected(this.table.getSelected().set(l,i)),console.log("header checkbox handler:",this.table.getSelected())}});if(e==="radio")return}}class F extends u{constructor({data:e,index:t,selection:s="checkbox",table:i,subscribe:l}){const r=document.createElement("tr");super(r,i._theme),this.UItype="TableRow",this.data=e,this.selection=this._checkSelection(s),this.cells=this._setTableCells(this.data,R(i)),this.index=t,this._init(),l(c=>{let n=c.get(i._pagination.currentPage);n&&(this.selection.setChecked(!0),this._render()),i.tableHeader.selection.setChecked(n)})}_init(){let e=document.createDocumentFragment();this.selection&&e.appendChild(this.selection.container);for(let t of this.cells)e.appendChild(t.getElem());this._elem.appendChild(e),a.setAttribute(this._elem,D,this.index),this._render(),this._bindEvent()}_render(){this.selection.getChecked()?a.setAttribute(this._elem,H):delete this._elem.dataset.rowselected}_bindEvent(){function e(t){let s=this.selection.getChecked();this.selection.setChecked(!s),this._render()}this.selection&&this.onevent(this.getElem(),"click",e.bind(this))}_checkSelection(e){let t=document.createElement("td");if(e==="checkbox")return new y(t,{checked:!1,theme:this._theme});if(e==="radio")return}_setTableCells(e,t){return Object.values(e).map((i,l)=>new O(i,t[l]))}}var I={field:"",title:"",sort:function(){},fixed:"",align:"left"};class O extends u{constructor(e,t){const s=document.createElement("td");super(s),this.UItype="TableCell",this.dataValue=e,this.config=Object.assign(I,t),this._init()}_init(){this._render()}_render(){let{field:e,align:t="left",template:s}=this.config;switch(t){case"center":a.addClass(this._elem,["text-center"]);break;case"right":a.addClass(this._elem,["text-right"]);break;default:a.clearClass(this._elem);break}a.setAttribute(this._elem,w,e),a.setText(this._elem,this.dataValue),s&&s.bind(this)(this.dataValue)}}//! 未來要獨自拆出檔案
const j="currentPage",N="prev",V="next";var U={jump:!0,initCurrentPage:1,pageSize:20,total:0};class M extends u{constructor(e){const t=document.createElement("div");a.addClass(t,["pagination"]),super(t,e.theme||"var(--color-primary-500)"),this.UItype="Pagination",this._config=Object.assign(U,e),this.currentPage=e.currentPage||1,this.total=Math.ceil(this.config.total/this.config.pageSize)||0,this.pages=this._createPages(this.total,this.currentPage),this.handler=e.handler,this._init()}get config(){return this._config}_init(){this._render(),this._bindEvent()}_render(){console.log(this),this._elem.innerHTML="",super.setTheme(this._theme),a.setProperty(this._elem,"--theme",this._theme);let e=document.createDocumentFragment();for(let t=0;t<this.pages.length;t++){let s=document.createElement("button");switch(s.type="button",this.pages[t].current&&a.setAttribute(s,j),a.addClass(s,["page-item"]),this.pages[t].type){case"prev-page":a.setText(s,"<<"),a.setAttribute(s,N);break;case"next-page":a.setText(s,">>"),a.setAttribute(s,V);break;case"start-ellipsis":a.setText(s,"..."),s.disabled=!0;break;case"end-ellipsis":a.setText(s,"..."),s.disabled=!0;break;default:a.setText(s,this.pages[t].page),s.dataset.page=this.pages[t].page;break}(this.pages[t].page<1||this.pages[t].page>this.total)&&(this.pages[t].page=this.currentPage,s.disabled=!0),e.appendChild(s)}this._elem.appendChild(e),this.config.jump&&this._createJumpCompo()}_bindEvent(){function e(t){if(t.stopPropagation(),!t.target.classList.contains("page-item"))return;let s=Number(t.target.dataset.page);s||(s=t.target.hasAttribute("data-prev")?this.currentPage-1:t.target.hasAttribute("data-next")?this.currentPage+1:this.currentPage),this.goPage(s),this.handler(s)}super.onevent(this._elem,"click",e.bind(this))}_createPages(e,t){let s=[],i=this.config.pageSize,l={type:"prev-page",page:this.currentPage-1,current:!1},r={type:"next-page",page:this.currentPage+1,current:!1};for(let n=1;n<=e;n++){let o;n===1||n===t||n===e||n===t+1||n===t-1?o="page":n<=t+i?o="start-ellipsis":n>=t+i&&(o="end-ellipsis");let h={type:o||"page",page:n,current:n===t};s.push(h)}let c=s.filter((n,o)=>{const{type:h}=n;return!(h==="start-ellipsis"&&s[o+1].type==="start-ellipsis"||h==="end-ellipsis"&&s[o+1].type==="end-ellipsis"||h==="start-ellipsis"&&s[o+1].type==="end-ellipsis")});return[l,...c,r]}_createJumpCompo(){if(this.total<=0)return;let e=document.createElement("div");a.addClass(e,["pagination-jump"]);let t=[];for(let l=1;l<=this.total;l++){let r={value:l,text:l};l===this.currentPage&&(r.selected=!0),t.push(r)}let s=new P("jump-dropdown",t,{filter:!0,filterHandler:function(){let r=this.value;this.parentNode.parentNode.querySelectorAll(".dropdown-item li").forEach(n=>{n.textContent.includes(r)?n.classList.remove("hidden"):n.classList.add("hidden")})}},(function(l){let r=Number(l.target.value);this.goPage(r),this.handler(r)}).bind(this)),i=document.createDocumentFragment();i.appendChild(document.createTextNode("前往第")),i.appendChild(s.containerEl),i.appendChild(document.createTextNode("頁")),e.appendChild(i),this._elem.appendChild(e)}renderPage(e){this._config={...this.config,total:e},this.total=Math.ceil(e/this._config.pageSize),this.pages=this._createPages(this.total,this.currentPage),this._render()}setCurrentPage(e){this.currentPage=e,this.pages=this._createPages(this.total,this.currentPage),this._config={...this.config,currentPage:e}}goPage(e){console.log(`go ${e} page`),!(e<1||e>this.total)&&(this.setCurrentPage(e),this._render())}}//! 未來要獨自拆出檔案
class z extends u{constructor(e){let t;switch(e.type){case"table":t=document.createElement("tr");break;case"text":break;case"img":break;default:t=document.createElement("div")}super(t),this.UItype="Skeleton",this.options=e,this._render()}_render(){a.addClass(this._elem,["skeleton"]),this.defineType(this.options.type,this.options?.colNum)}defineType(e,t){switch(a.clearClass(this._elem,["skeleton"]),e){case"table":a.addClass(this._elem,["table-skeleton"]),this._elem.innerHTML=`
          <td colspan='${t}' class="shadow-sm animate-pulse">
              <div class="flex items-center justify-between">
                  <div>
                      <div class="h-2.5 bg-gray-300 rounded-full w-24 mb-2.5"></div>
                      <div class="w-32 h-2 bg-gray-200 rounded-full"></div>
                  </div>
                  <div class="h-2.5 bg-gray-300 rounded-full w-12"></div>
              </div>
              <div class="flex items-center justify-between pt-4">
                  <div>
                      <div class="h-2.5 bg-gray-300 rounded-full w-24 mb-2.5"></div>
                      <div class="w-32 h-2 bg-gray-200 rounded-full"></div>
                  </div>
                  <div class="h-2.5 bg-gray-300 rounded-full w-12"></div>
              </div>
              <div class="flex items-center justify-between pt-4">
                  <div>
                      <div class="h-2.5 bg-gray-300 rounded-full w-24 mb-2.5"></div>
                      <div class="w-32 h-2 bg-gray-200 rounded-full"></div>
                  </div>
                  <div class="h-2.5 bg-gray-300 rounded-full w-12"></div>
              </div>
              <span class="sr-only">Loading...</span>
          </td>`;break;case"text":a.addClass(this._elem,["text-skeleton"]),this._elem.innerHTML=`
          <div role="status" class="max-w-sm animate-pulse">
              <div class="h-2.5 bg-gray-200 rounded-full w-48 mb-4"></div>
              <div class="h-2 bg-gray-200 rounded-full max-w-[360px] mb-2.5"></div>
              <div class="h-2 bg-gray-200 rounded-full mb-2.5"></div>
              <div class="h-2 bg-gray-200 rounded-full max-w-[330px] mb-2.5"></div>
              <div class="h-2 bg-gray-200 rounded-full max-w-[300px] mb-2.5"></div>
              <div class="h-2 bg-gray-200 rounded-full max-w-[360px]"></div>
              <span class="sr-only">Loading...</span>
          </div>`;break;case"img":a.addClass(this._elem,["img-skeleton"]),this._elem.innerHTML=`
          <div role="status" class="flex items-center justify-center h-56 max-w-sm bg-gray-300 rounded-lg animate-pulse">
              <svg class="w-10 h-10 text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 20">
              <path d="M5 5V.13a2.96 2.96 0 0 0-1.293.749L.879 3.707A2.98 2.98 0 0 0 .13 5H5Z"/>
              <path d="M14.066 0H7v5a2 2 0 0 1-2 2H0v11a1.97 1.97 0 0 0 1.934 2h12.132A1.97 1.97 0 0 0 16 18V2a1.97 1.97 0 0 0-1.934-2ZM9 13a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2Zm4 .382a1 1 0 0 1-1.447.894L10 13v-2l1.553-1.276a1 1 0 0 1 1.447.894v2.764Z"/>
            </svg>
              <span class="sr-only">Loading...</span>
          </div>`;break}}show(){a.removeClass(this._elem,["hidden"])}hide(){a.addClass(this._elem,["hidden"])}}window.Table=v;const $=({id:d,name:e,limits:t,selection:s,container:i,cols:l,tools:r,theme:c,classes:n,complete:o,error:h,handler:C})=>{let g=document.createElement("div");g.className="mx-auto grid place-items-center";let m=document.createElement("button");m.className="btn btn-primary mb-3",m.textContent="create Table";let _=document.createElement("div");_.className="table-test-target",g.appendChild(m),g.appendChild(_);let x={id:d,name:e,limits:t,container:i||".table-test-target",cols:l,tools:r,selection:s,theme:c,classes:n,complete:o,error:h,handler:C};async function k(p){return await fetch(p)}return m.addEventListener("click",()=>{let p=new v(x);k("https://jsonplaceholder.typicode.com/todos").then(f=>f.json()).then(f=>{setTimeout(()=>{p.setData(f).selectedFullPage(1),console.log("table_instance:",p)},5e3)})}),g},{fn:ee,expect:te}=__STORYBOOK_MODULE_TEST__,{action:se}=__STORYBOOK_MODULE_ACTIONS__,ie={title:"Components/Table",tags:["autodocs"],parameters:{docs:{source:{format:!0,language:"html"},page:A}},render:({...d})=>$({...d}),argTypes:{id:{control:"text",type:{required:!0},description:"表格元素id",table:{category:"configurations",type:{summary:"string"}}},name:{control:"text",description:"Table name",table:{category:"configurations",defaultValue:{summary:"-"},type:{summary:"string"}}},limits:{control:"number",description:"每頁顯示的最多筆數",min:1,table:{category:"configurations",defaultValue:{summary:"50"},type:{summary:"number"}}},container:{control:"text",description:"要放入的DOM元素",table:{category:"configurations",defaultValue:{summary:"null"},type:{summary:"string"}}},cols:{control:"array",description:"欄位設定及帶入值",table:{category:"configurations",defaultValue:{summary:"-"},type:{summary:"array"}}},selection:{control:"select",options:["checkbox","radio"],description:"是否要有勾選功能",table:{category:"configurations",defaultValue:{summary:"checkbox"},type:{summary:"string"}}},tools:{control:"boolean",description:"是否要有基本工具列",table:{category:"configurations",defaultValue:{summary:"true"},type:{summary:"boolean"}}},theme:{control:"color",description:"表格色系",table:{category:"configurations",defaultValue:{summary:"var(--color-primary-500)"},type:{summary:"string"}}},complete:{control:"function",description:"完成資料載入後要執行的函式",table:{category:"configurations",type:{summary:"function"}}},classes:{control:{type:"array"},description:"自定義class，每個class以tailwindcss property放入",table:{category:"configurations",defaultValue:{summary:".table-container"},type:{summary:"array"}}},error:{control:{type:"function"},description:"資料載入失敗時要執行的函式",table:{category:"configurations",type:{summary:"function"}}},handler:{action:"click",control:"function",description:"點擊觸發元素後的callback函式",table:{category:"configurations",defaultValue:{summary:"null"},type:{summary:"function"}}}},args:{id:"table_first",classes:["table-container"],limits:20,selection:"checkbox",tools:!0,theme:"var(--color-primary-500)"}},b={args:{id:"test-table",name:"測試表格",cols:[{field:"useId",title:"使用者id",sort:!0,fixed:!1,align:"center",template:function(d){d===1&&a.setText(this.getElem(),"01")}},{field:"id",title:"編號",sort:!1,fixed:!1,align:"center"},{field:"title",title:"內容",sort:!0,fixed:!1},{field:"done",title:"完成",sort:!0,fixed:!1,align:"center"}],limits:20,container:".table-test-target"}};b.parameters={...b.parameters,docs:{...b.parameters?.docs,source:{originalSource:`{
  args: {
    id: "test-table",
    name: "測試表格",
    cols: [{
      field: 'useId',
      title: '使用者id',
      sort: true,
      fixed: false,
      align: "center",
      template: function (data) {
        if (data === 1) {
          UIUtils.setText(this.getElem(), "01");
        }
      }
    }, {
      field: 'id',
      title: '編號',
      sort: false,
      fixed: false,
      align: "center"
    }, {
      field: 'title',
      title: '內容',
      sort: true,
      fixed: false
    }, {
      field: 'done',
      title: '完成',
      sort: true,
      fixed: false,
      align: "center"
    }],
    limits: 20,
    container: '.table-test-target'
  }
  // play: async ({ args, canvas, userEvent }) => {
  //   await userEvent.type(canvas.getByText('一般勾選框'), '勾選框');
  //   await userEvent.click(canvas.getByLabelText('一般勾選框'));
  //   await expect(args.handlers).toHaveBeenCalled();
  // }
}`,...b.parameters?.docs?.source}}};const ae=["Table"];export{b as Table,ae as __namedExportsOrder,ie as default};
